```sql

CREATE TABLE `96365_pay`.`trade_order` (
  `trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
  `out_trade_no` varchar(64) NOT NULL COMMENT '商户唯一订单号',
  `merchant_id` varchar(20) NOT NULL COMMENT '入驻商户ID',
  `notify_url` varchar(256) DEFAULT NULL COMMENT '支付成功后支付中心主动回调通知商户的接口地址',
  `return_url` varchar(256) DEFAULT NULL COMMENT '支付成功后跳转商户的页面链接',
  `quit_url` varchar(400) DEFAULT NULL COMMENT '用户付款中途退出返回商户网站的地址',
  `expires_in` int(11) NOT NULL DEFAULT '259200' COMMENT '支付有效期，逾期将关闭交易，单位：秒，默认259200秒=3天。',
  `timeout` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '过期时间，逾期将关闭交易。',
  `subject` varchar(256) NOT NULL COMMENT '订单标题',
  `body` varchar(256) DEFAULT NULL COMMENT '订单描述',
  `postscript` varchar(256) DEFAULT NULL COMMENT '交易附言，订单金额大于50000元时必填',
  `total_amount` int(11) NOT NULL COMMENT '订单总金额，单位：分',
  `discount_amount` int(11) NOT NULL DEFAULT '0' COMMENT '优惠金额，单位：分',
  `actual_amount` int(11) NOT NULL COMMENT '实付金额（总金额-优惠金额），单位：分',
  `service_charge_percent` int(11) NOT NULL COMMENT '手续费百分比，取值范围[0-100]',
  `status` varchar(20) NOT NULL COMMENT '订单状态',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`trade_no`),
  UNIQUE KEY `out_trade_no` (`out_trade_no`),
  KEY `status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='基础交易订单';


CREATE TABLE `96365_pay`.`pay_serial` (
  `serial_no` varchar(20) NOT NULL COMMENT '支付交易流水号',
  `trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
  `out_trade_no` varchar(20) NOT NULL COMMENT '商户唯一订单号',
  `merchant_id` varchar(20) NOT NULL COMMENT '商户ID',
  `channel` varchar(20) NOT NULL COMMENT '支付通道类型',
  `service_id` varchar(20) NOT NULL COMMENT '支付服务类型',
  `app_id` varchar(64) NOT NULL COMMENT '商户在支付宝、微信等第三方渠道申请的应用ID',
  `ip` varchar(64) NOT NULL COMMENT '用户端IP',
  `total_amount` int(11) NOT NULL COMMENT '支付实付交易金额，单位：分',
  `service_charge` int(11) NOT NULL COMMENT '平台手续费（平台抽成），单位：分',
  `channel_fee` int(11) NOT NULL DEFAULT '0' COMMENT '通道手续费，单位：分',
  `inner_channel_fee` int(11) NOT NULL DEFAULT '0' COMMENT '内部通道手续费（比如连连通道里的微信通道手续费），单位：分',
  `status` varchar(20) NOT NULL COMMENT '支付状态',
  `notify_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否收到回调',
  `handle_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否处理成功（上游）',
  `channel_serial_no` varchar(64) DEFAULT NULL COMMENT '通道流水号',
  `inner_channel_serial_no` varchar(64) DEFAULT NULL COMMENT '内部通道流水号',
  `trade_time` timestamp NULL DEFAULT NULL COMMENT '交易时间',
  `unfrozen_time` timestamp NULL DEFAULT NULL COMMENT '解冻时间',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`serial_no`),
  KEY `status` (`status`),
  KEY `notify_flag` (`notify_flag`),
  KEY `trade_no` (`trade_no`,`out_trade_no`),
  KEY `channel_service` (`channel`,`service_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='支付流水表';

CREATE TABLE `96365_pay`.`refund_serial` (
  `serial_no` varchar(20) NOT NULL COMMENT '退款交易流水号',
  `pay_serial_no` varchar(20) NOT NULL COMMENT '支付交易流水号',
  `trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
  `out_trade_no` varchar(20) NOT NULL COMMENT '商户唯一订单号',
  `total_amount` int(11) NOT NULL COMMENT '支付实付交易金额，单位：分',
  `refund_reason` varchar(256) NOT NULL COMMENT '退款原因',
  `status` varchar(20) NOT NULL COMMENT '退款状态',
  `notify_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否收到回调',
  `handle_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否正常处理',
  `channel_serial_no` varchar(64) DEFAULT NULL COMMENT '通道流水号',
  `inner_channel_serial_no` varchar(64) DEFAULT NULL COMMENT '内部通道流水号',
  `trade_time` timestamp NULL DEFAULT NULL COMMENT '交易时间',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`serial_no`),
  KEY `status` (`status`),
  KEY `notify_flag` (`notify_flag`),
  KEY `pay_serial_no` (`pay_serial_no`),
  KEY `trade_no` (`trade_no`,`out_trade_no`),
  KEY `channel_serial_no` (`channel_serial_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='退款流水表';


CREATE TABLE `96365_pay`.`sharing_serial` (
  `serial_no` varchar(20) NOT NULL COMMENT '分账交易流水号',
  `pay_serial_no` varchar(20) NOT NULL COMMENT '支付交易流水号',
  `trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
  `out_trade_no` varchar(20) NOT NULL COMMENT '商户唯一订单号',
  `channel` varchar(20) NOT NULL COMMENT '支付通道类型',
  `service_id` varchar(20) NOT NULL COMMENT '支付服务类型',
  `total_amount` int(11) NOT NULL COMMENT '支付实付交易金额，单位：分',
  `status` varchar(20) NOT NULL COMMENT '分账状态',
  `notify_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否收到回调',
  `handle_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否正确处理',
  `channel_serial_no` varchar(64) DEFAULT NULL COMMENT '通道流水号',
  `trade_time` timestamp NULL DEFAULT NULL COMMENT '交易时间',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`serial_no`),
  KEY `status` (`status`),
  KEY `notify_flag` (`notify_flag`),
  KEY `pay_serial_no` (`pay_serial_no`),
  KEY `trade_no` (`trade_no`,`out_trade_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='分账流水表';


CREATE TABLE `96365_pay`.`transfer_serial` (
  `serial_no` varchar(20) NOT NULL COMMENT '转账交易流水号',
  `trade_serial_no` varchar(20) NOT NULL COMMENT '交易流水号',
  `type` varchar(20) NOT NULL COMMENT '转账类型',
  `trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
  `out_trade_no` varchar(20) NOT NULL COMMENT '商户唯一订单号',
  `channel` varchar(20) NOT NULL COMMENT '支付通道类型',
  `service_id` varchar(20) NOT NULL COMMENT '支付服务类型',
  `total_amount` int(11) NOT NULL COMMENT '支付实付交易金额，单位：分',
  `source_account_id` varchar(20) NOT NULL COMMENT '来源账户ID',
  `target_account_id` varchar(20) NOT NULL COMMENT '去向账户ID',
  `remark` varchar(256) NOT NULL COMMENT '转账说明',
  `status` varchar(20) NOT NULL COMMENT '支付状态',
  `notify_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否收到回调',
  `handle_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否正确处理',
  `channel_serial_no` varchar(64) DEFAULT NULL COMMENT '通道流水号',
  `trade_time` timestamp NULL DEFAULT NULL COMMENT '交易时间',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`serial_no`),
  KEY `status` (`status`),
  KEY `notify_flag` (`notify_flag`),
  KEY `pay_serial_no` (`trade_serial_no`),
  KEY `trade_no` (`trade_no`,`out_trade_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='转账流水表';


CREATE TABLE `96365_pay`.`withdrawal_serial` (
  `serial_no` varchar(20) NOT NULL COMMENT '支付交易流水号',
  `merchant_id` varchar(20) NOT NULL COMMENT '商户ID，为空时表示平台提现',
  `account_id` varchar(20) NOT NULL COMMENT '账户ID',
  `account_flow_ids` varchar(20000) NOT NULL COMMENT '账户资金流水IDs',
  `channel` varchar(20) NOT NULL COMMENT '支付通道类型',
  `service_id` varchar(20) NOT NULL COMMENT '支付服务类型',
  `total_amount` int(11) NOT NULL COMMENT '提现交易金额，单位：分',
  `service_charge` int(11) NOT NULL DEFAULT '0' COMMENT '平台手续费（平台抽成），单位：分',
  `channel_fee` int(11) NOT NULL DEFAULT '0' COMMENT '通道手续费，单位：分',
  `postscript` varchar(256) DEFAULT NULL COMMENT '交易附言',
  `status` varchar(20) NOT NULL COMMENT '提现状态',
  `notify_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否收到回调',
  `handle_flag` varchar(1) NOT NULL DEFAULT '0' COMMENT '是否处理成功（上游）',
  `channel_serial_no` varchar(64) DEFAULT NULL COMMENT '通道流水号',
  `failure_reason` varchar(512) DEFAULT NULL COMMENT '提现失败原因',
  `valid_token` varchar(64) DEFAULT NULL COMMENT '交易二次验证token',
  `timeout` timestamp NULL DEFAULT NULL COMMENT '交易有效期，超时关单时间',
  `trade_time` timestamp NULL DEFAULT NULL COMMENT '交易时间',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`serial_no`),
  KEY `status` (`status`),
  KEY `notify_flag` (`notify_flag`),
  KEY `account_id` (`account_id`),
  KEY `channel_service` (`channel`,`service_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='提现流水表';

ALTER TABLE `96365_pay`.error_log MODIFY COLUMN `params` varchar(10000) DEFAULT NULL COMMENT '方法参数';

ALTER TABLE `96365_pay`.account_flow_log MODIFY COLUMN `parent_flow_id` text NOT NULL COMMENT '父资金流ID';


CREATE TABLE `96365_pay`.`operation_log` (
  `log_id` varchar(20) NOT NULL COMMENT '日志ID',
  `type` varchar(20) NOT NULL COMMENT '操作类型',
  `object_id` varchar(20) NOT NULL COMMENT '关联操作对象ID',
  `content` varchar(512) NOT NULL COMMENT '操作内容',
  `user_id` varchar(20) NOT NULL COMMENT '操作人ID',
  `user_name` varchar(20) NOT NULL COMMENT '操作人姓名',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`log_id`),
  KEY `type_object_id` (`type`,`object_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='操作日志';




INSERT INTO `96365_user`.`function_info`(`FUNCTION_ID`, `FUNCTION_NAME`, `TYPE`, `PRIORITY`, `PARENT_ID`, `PARENT_IDS`, `LEVEL`, `PERMISSION`, `URL`, `CREATE_DATE`, `CREATE_ID`, `MODIFY_DATE`, `MODIFY_ID`, `PARAM`) VALUES (298, '财务管理', '0', 3, 0, ',0,', 1, 'finance', NULL, NOW(), NULL, NULL, NULL, NULL);
INSERT INTO `96365_user`.`function_info`(`FUNCTION_ID`, `FUNCTION_NAME`, `TYPE`, `PRIORITY`, `PARENT_ID`, `PARENT_IDS`, `LEVEL`, `PERMISSION`, `URL`, `CREATE_DATE`, `CREATE_ID`, `MODIFY_DATE`, `MODIFY_ID`, `PARAM`) VALUES (299, '销售统计', '1', 0, 298, ',0,298,', 2, 'finance.serial', NULL, NOW(), NULL, NULL, NULL, NULL);
INSERT INTO `96365_user`.`function_info`(`FUNCTION_ID`, `FUNCTION_NAME`, `TYPE`, `PRIORITY`, `PARENT_ID`, `PARENT_IDS`, `LEVEL`, `PERMISSION`, `URL`, `CREATE_DATE`, `CREATE_ID`, `MODIFY_DATE`, `MODIFY_ID`, `PARAM`) VALUES (300, '支付流水列表', '2', 0, 299, ',0,298,299,', 3, 'finance.serial.paySerials', '/llPay/admin/queryPaySerials', NOW(), NULL, NULL, NULL, NULL);


```

------------未使用的表----------
```sql
CREATE TABLE `trade_payee` (
	`id` varchar(20) NOT NULL COMMENT 'ID',
	`trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
	`payee_id` varchar(20) NOT NULL COMMENT '收款方ID',
	`payee_type` varchar(20) NOT NULL COMMENT '收款方类型',
	`payee_amount` int(11) NOT NULL COMMENT '收款金额，单位：分',
	`payee_memo` varchar(256) DEFAULT NULL COMMENT '收款备注',
	PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='交易收款方信息';


CREATE TABLE `trade_goods` (
	`goods_id` varchar(20) NOT NULL COMMENT '交易商品ID',
	`trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
	`goods_name` varchar(256) NOT NULL COMMENT '商品名称',
	`quantity` int(11) NOT NULL COMMENT '商品数量',
	`price` int(11) NOT NULL COMMENT '商品单价，单位：分',
	`body` varchar(1000) DEFAULT NULL COMMENT '商品描述信息',
	`show_url` varchar(400) DEFAULT NULL COMMENT '商品展示地址',
	PRIMARY KEY (`goods_id`),
	KEY `trade_no_index` (`trade_no`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='基础交易订单包含的商品信息';

-- 分账待定
CREATE TABLE `trade_sharing` (
	`sharing_no` varchar(20) NOT NULL COMMENT '分账流水号',
	`trade_no` varchar(20) NOT NULL COMMENT '支付中心唯一交易订单号',
	`out_trade_no` varchar(20) NOT NULL COMMENT '商户唯一订单号',
	`total_amount` int(11) NOT NULL COMMENT '支付实付交易金额，单位：分',
	`channel_fee` int(11) NOT NULL DEFAULT 0 COMMENT '通道手续费，单位：分',
	`channel_fee_inner` int(11) NOT NULL DEFAULT 0 COMMENT '内部通道手续费（比如连连通道里的微信通道手续费），单位：分',
	`status` varchar(20) NOT NULL COMMENT '支付状态',
	`channel_serial_no` varchar(64) DEFAULT NULL COMMENT '通道流水号',
	`trade_time` timestamp NULL DEFAULT NULL COMMENT '交易时间',
	`create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	`modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY (`serial_no`),
	KEY `trade_no_index` (`trade_no`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='分账流水表';
```
------------未使用的表----------

------------------自己开发中----------
## 2021-3-22 优化

- feature_trade_fix
```sql


ALTER TABLE pay_serial ADD COLUMN `failure_reason` varchar(512) DEFAULT NULL COMMENT '支付失败原因' AFTER inner_channel_serial_no;

ALTER TABLE refund_serial ADD COLUMN `failure_reason` varchar(512) DEFAULT NULL COMMENT '退款失败原因' AFTER inner_channel_serial_no;

ALTER TABLE transfer_serial ADD COLUMN `failure_reason` varchar(512) DEFAULT NULL COMMENT '转账失败原因' AFTER channel_serial_no;

ALTER TABLE account_flow ADD COLUMN `source` varchar(20) NOT NULL COMMENT '资金流水来源' AFTER trade_message_id;



```

## 代码通道化，引入商户体系
```sql

-- 商户
CREATE TABLE `merchant` (
	`merchant_id` varchar(20) NOT NULL COMMENT '商户ID',
	`merchant_name` varchar(64) NOT NULL COMMENT '商户名称',
	`contact_name` varchar(20) NOT NULL COMMENT '联系人姓名',
	`contact_phone` varchar(20) NOT NULL COMMENT '联系电话',
	`status` varchar(20) NOT NULL COMMENT '商户状态',
	`create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY (`merchant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='入驻商户信息';


-- 二级商户
CREATE TABLE `secondary_merchant` (
	`sec_merchant_id` varchar(20) NOT NULL COMMENT '二级商户ID',
	`sec_merchant_name` varchar(64) NOT NULL COMMENT '二级商户名称',
	`merchant_id` varchar(20) NOT NULL COMMENT '商户ID',
	`contact_name` varchar(20) NOT NULL COMMENT '联系人姓名',
	`contact_phone` varchar(20) NOT NULL COMMENT '联系电话',
	`status` varchar(20) NOT NULL COMMENT '二级商户状态',
	`create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY (`sec_merchant_id`),
	KEY `merchant_id` (`merchant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='二级商户信息';


CREATE TABLE `merchant_channel` (
	`m_channel_id` varchar(20) NOT NULL COMMENT '商户通道信息ID',
	`merchant_id` varchar(20) NOT NULL COMMENT '商户ID',
	`channel` varchar(20) NOT NULL COMMENT '支付通道',
	`channel_config` text NOT NULL COMMENT '支付通道配置信息',
	`app_id` varchar(64) NOT NULL COMMENT '微信分配的应用ID',
	`create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY (`m_channel_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='商户通道配置信息';


ALTER TABLE pay_serial ADD COLUMN `openid` varchar(64) NOT NULL DEFAULT '' COMMENT '第三方渠道用户标识' AFTER app_id;
ALTER TABLE pay_serial ADD COLUMN `postscript` varchar(256) DEFAULT NULL COMMENT '交易附言，订单金额大于50000元时必填' AFTER inner_channel_fee;


```