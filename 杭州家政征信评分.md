## 建表

```sql
CREATE TABLE `dimension`(
	`dimension_id` VARCHAR(20) NOT NULL COMMENT '维度ID',
	`dimension_name` VARCHAR(30) NOT NULL COMMENT '维度名称',
	`dimension_key` VARCHAR(10) NOT NULL COMMENT '维度关键字',
	`dimension_weight` int(11) NOT NULL DEFAULT 0 COMMENT '维度权重',
	`sort` int(11) NOT NULL DEFAULT 0 COMMENT '排序',
	`del_flag` VARCHAR(1) NOT NULL DEFAULT '1' COMMENT '逻辑删除用(置0)',
	`create_id` VARCHAR(20) NOT NULL COMMENT '创建人ID',
	`create_date` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	`modify_id` VARCHAR(20) DEFAULT NULL COMMENT '修改人ID',
	`modify_date` TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY(`dimension_id`),
	UNIQUE KEY `dimension_key_index` (`dimension_key`) USING BTREE
)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '征信评分维度表';

CREATE TABLE `indicators` (
  `indicators_id` varchar(20) NOT NULL COMMENT '指标ID',
  `indicators_name` varchar(30) NOT NULL COMMENT '指标名称',
  `indicators_key` varchar(10) NOT NULL COMMENT '指标关键字',
  `indicators_score` int(11) NOT NULL COMMENT '指标积分',
  `indicators_weight` int(11) DEFAULT '0' COMMENT '指标权重',
  `expand` varchar(500) DEFAULT NULL COMMENT '拓展字段',
  `dimension_id` varchar(20) NOT NULL COMMENT '维度ID',
  `dimension_key` varchar(10) NOT NULL COMMENT '维度关键字',
  `sort` int(11) NOT NULL DEFAULT '0' COMMENT '排序',
  `del_flag` varchar(1) NOT NULL DEFAULT '1' COMMENT '逻辑删除用(置0)',
  `create_id` varchar(20) NOT NULL COMMENT '创建人ID',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `modify_id` varchar(20) DEFAULT NULL COMMENT '修改人ID',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`indicators_id`),
  UNIQUE KEY `indicators_key_index` (`indicators_key`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='征信评分指标表';

CREATE TABLE `insurance` (
  `insurance_id` varchar(20) NOT NULL,
	`insurance_type` varchar(20) NOT NULL COMMENT '保险方案号',
  `insurance_name` varchar(45) NOT NULL COMMENT '保险名称',
  `insurance_key` varchar(10) NOT NULL COMMENT '保险关键字',
  `insurance_detail` varchar(200) DEFAULT NULL COMMENT '保险详情',
  `insurance_status` varchar(1) NOT NULL DEFAULT '1' COMMENT '保险状态：禁用为0,正常为1',
	`service_ids` varchar(100) NOT NULL COMMENT '服务工种IDs',
  `del_flag` varchar(1) NOT NULL COMMENT '逻辑删除0：删除　1：未删除',
  `create_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `create_id` varchar(20) DEFAULT NULL COMMENT '创建人ID',
  `modify_date` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `modify_id` varchar(20) DEFAULT NULL COMMENT '修改人ID',
  PRIMARY KEY (`insurance_id`),
  UNIQUE KEY `insurance_key_index` (`insurance_key`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT '其他保险表';

CREATE TABLE `employee_indicators`(
	`emp_indicators_id` VARCHAR(20) NOT NULL,
	`emp_id` varchar(20) NOT NULL COMMENT '员工id',
	`emp_card_code` varchar(20) NOT NULL COMMENT '对应employee_card_code表id',
	`indicators_key` VARCHAR(10) NOT NULL COMMENT '指标关键字',
	`dimension_key` VARCHAR(10) NOT NULL COMMENT '维度关键字',
	`verify_flag` VARCHAR(1) NOT NULL DEFAULT '0' COMMENT '审核标志(0=未审核；1=通过；2=不通过)',
	`verify_opinions` VARCHAR(200) DEFAULT NULL COMMENT '审核意见',
	`del_flag` VARCHAR(1) NOT NULL DEFAULT '1' COMMENT '逻辑删除用(置0)',
	`create_id` VARCHAR(20) NOT NULL COMMENT '创建人ID',
	`create_date` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	`modify_id` VARCHAR(20) DEFAULT NULL COMMENT '修改人ID',
	`modify_date` TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY(`emp_indicators_id`),
	KEY `indicators_key_index` (`indicators_key`) USING BTREE
)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '服务人员指标关系表';


CREATE TABLE `employee_indicators_linked`(
	`linked_id` VARCHAR(20) NOT NULL,
	`emp_indicators_id` VARCHAR(20) NOT NULL COMMENT '关联employee_indicators表的ID',
	`linked_name` VARCHAR(30) NOT NULL COMMENT '链表节点名称',
	`parent_id` VARCHAR(20) NOT NULL DEFAULT '0' COMMENT '父节点ID',
	`data_type` VARCHAR(3) NOT NULL COMMENT '节点内容数据类型，对应枚举类DateTypeEnum',
	`precision_number` int(11) DEFAULT NULL COMMENT '数字精确值',
	`precision_string` VARCHAR(50) DEFAULT NULL COMMENT '字符串精确值',
	`precision_timestamp` TIMESTAMP NULL DEFAULT NULL COMMENT '日期时间精确值',
	`section_number_start` int(11) DEFAULT NULL COMMENT '数字区间开始值',
	`section_number_end` int(11) DEFAULT NULL COMMENT '数字区间结束值',
	`section_string_start` VARCHAR(50) DEFAULT NULL COMMENT '字符串区间开始值',
	`section_string_end` VARCHAR(50) DEFAULT NULL COMMENT '字符串区间结束值',
	`section_timestamp_start` TIMESTAMP NULL DEFAULT NULL COMMENT '日期时间区间开始值',
	`section_timestamp_end` TIMESTAMP NULL DEFAULT NULL COMMENT '日期时间区间结束值',
	`sort` int(11) NOT NULL DEFAULT 0 COMMENT '排序',
	`show_flag` VARCHAR(1) NOT NULL DEFAULT '1' COMMENT '是否在服务人员详情页显示(0=否；1=是)',
	`score_flag` VARCHAR (3) NOT NULL DEFAULT '0' COMMENT '是否参与积分计算(0=否；1=是)',
	`del_flag` VARCHAR(1) NOT NULL DEFAULT '1' COMMENT '逻辑删除用(置0)',
	`create_id` VARCHAR(20) NOT NULL COMMENT '创建人ID',
	`create_date` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	`modify_id` VARCHAR(20) DEFAULT NULL COMMENT '修改人ID',
	`modify_date` TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY(linked_id),
	KEY `emp_indicators_id_index` (`emp_indicators_id`) USING BTREE,
	KEY `data_type_index` (`data_type`) USING BTREE
)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '服务人员和指标信息拓展链表';
```

## 修改表结构

- 工作经历表添加审核

```sql
ALTER TABLE `employee_experience` ADD COLUMN `verify_flag` varchar(2) NOT NULL DEFAULT '1' COMMENT '审核标志（0=未审核，1=通过，2=不通过）';

ALTER TABLE `employee_experience` ADD COLUMN `verify_opinions` varchar(200) DEFAULT NULL COMMENT '审核意见';
```

- 证书表添加审核和关键字

执行前应先生成所有证书

```sql
ALTER TABLE `employee_certificate` ADD COLUMN `verify_flag` varchar(2) NOT NULL DEFAULT '1' COMMENT '审核标志（0=未审核，1=通过，2=不通过）';

ALTER TABLE `employee_certificate` ADD COLUMN `verify_opinions` varchar(200) DEFAULT NULL COMMENT '审核意见';

ALTER TABLE `employee_certificate` ADD COLUMN `certificate_key` varchar(10) NOT NULL DEFAULT '' COMMENT '证书关键字';

UPDATE employee_certificate ec 
LEFT JOIN certificate c ON c.certificate_name = ec.CERTIFICATE_NAME 
SET ec.certificate_key = c.certificate_key 
WHERE ec.del_flag = '1' AND c.del_flag = '1';
```

- 保险表添加审核和关键字

执行前应先生成所有保险

```sql
SELECT insurance_company FROM employee_insurance_info WHERE del_flag = '1' GROUP BY insurance_company;
```

```sql
ALTER TABLE `employee_insurance_info` ADD COLUMN `verify_flag` varchar(2) NOT NULL DEFAULT '1' COMMENT '审核标志（0=未审核，1=通过，2=不通过）';

ALTER TABLE `employee_insurance_info` ADD COLUMN `verify_opinions` varchar(200) DEFAULT NULL COMMENT '审核意见';

ALTER TABLE `employee_insurance_info` ADD COLUMN `insurance_key` varchar(10) NOT NULL DEFAULT '' COMMENT '保险关键字';

UPDATE employee_insurance_info eii 
LEFT JOIN insurance i ON i.insurance_name = eii.insurance_company 
SET eii.insurance_key = i.insurance_key 
WHERE eii.del_flag = '1' AND i.del_flag = '1';
```

### 弃用sql

```sql
CREATE TABLE `indicators`(
	`indicators_id` VARCHAR(20) NOT NULL COMMENT '指标节点ID',
	`indicators_name` VARCHAR(30) NOT NULL COMMENT '指标节点名称',
	`indicators_key` VARCHAR(10) DEFAULT NULL COMMENT '指标关键字',
	`indicators_score` int(11) DEFAULT NULL COMMENT '指标积分',
	`indicators_weight` int(11) DEFAULT NULL DEFAULT 0 COMMENT '指标权重',
	`level` int(11) NOT NULL DEFAULT 0 COMMENT '层级',
	`parent_id` VARCHAR(20) NOT NULL DEFAULT '0' COMMENT '父节点ID',
	`root_id` VARCHAR(20) NOT NULL COMMENT '根节点ID',
	`dimension_id` VARCHAR(20) NOT NULL COMMENT '维度ID',
	`dimension_key` VARCHAR(10) NOT NULL COMMENT '维度关键字',
	`data_type` VARCHAR(3) NOT NULL COMMENT '节点内容数据类型，对应枚举类DateTypeEnum',
	`precision_number` int(11) DEFAULT NULL COMMENT '数字精确值',
	`precision_string` VARCHAR(50) DEFAULT NULL COMMENT '字符串精确值',
	`precision_timestamp` TIMESTAMP NULL DEFAULT NULL COMMENT '日期时间精确值',
	`section_number_start` int(11) DEFAULT NULL COMMENT '数字区间开始值',
	`section_number_end` int(11) DEFAULT NULL COMMENT '数字区间结束值',
	`section_string_start` VARCHAR(50) DEFAULT NULL COMMENT '字符串区间开始值',
	`section_string_end` VARCHAR(50) DEFAULT NULL COMMENT '字符串区间结束值',
	`section_timestamp_start` TIMESTAMP NULL DEFAULT NULL COMMENT '日期时间区间开始值',
	`section_timestamp_end` TIMESTAMP NULL DEFAULT NULL COMMENT '日期时间区间结束值',
	`sort` int(11) NOT NULL DEFAULT 0 COMMENT '排序',
	`show_flag` VARCHAR(1) NOT NULL DEFAULT '1' COMMENT '是否在服务人员详情页显示(0=否；1=是)',
	`del_flag` VARCHAR(1) NOT NULL DEFAULT '1' COMMENT '逻辑删除用(置0)',
	`create_id` VARCHAR(20) NOT NULL COMMENT '创建人ID',
	`create_date` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
	`modify_id` VARCHAR(20) DEFAULT NULL COMMENT '修改人ID',
	`modify_date` TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
	PRIMARY KEY(`indicators_id`),
	UNIQUE KEY `indicators_key_index` (`indicators_key`) USING BTREE,
	KEY `data_type_index` (`data_type`) USING BTREE
)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT '征信评分指标表';
```